{% load static %}
<aside class="flex h-screen min-h-[700px] w-64 flex-col justify-between bg-gradient-to-b from-slate-50 to-white dark:from-slate-900 dark:to-slate-800 p-4 border-r-2 border-primary/20 dark:border-primary/10 sticky top-0">
  <div class="flex flex-col gap-6">
    <div class="flex items-center gap-3 px-3 py-2 rounded-xl bg-primary/5 dark:bg-primary/10 border border-primary/20 dark:border-primary/30">
      <img src="{% static 'images/images.png' %}" alt="Logo UBO" class="size-10"/>
      <div class="flex flex-col">
        <h1 class="text-primary font-bold leading-normal">UBO</h1>
        <p class="text-[#616f89] dark:text-slate-400 text-xs font-medium leading-normal">Hub √âtudiant</p>
      </div>
    </div>

    <nav class="flex flex-col gap-3">
      <a class="flex items-center gap-3 px-3 py-2.5 rounded-xl {% if active == 'dashboard' %}bg-primary/15 dark:bg-primary/20 border border-primary/30 dark:border-primary/40{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:dashboard' %}">
        <span class="material-symbols-outlined {% if active == 'dashboard' %}text-primary dark:text-primary{% else %}text-[#111318] dark:text-slate-300{% endif %}">home</span>
        <p class="{% if active == 'dashboard' %}text-primary dark:text-primary text-sm font-semibold leading-normal{% else %}text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal{% endif %}">Accueil</p>
      </a>

      <a class="flex items-center gap-3 px-3 py-2.5 rounded-xl {% if active == 'calendar' %}bg-primary/15 dark:bg-primary/20 border border-primary/30 dark:border-primary/40{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:calendar' %}">
        <span class="material-symbols-outlined {% if active == 'calendar' %}text-primary dark:text-primary{% else %}text-[#111318] dark:text-slate-300{% endif %}">calendar_month</span>
        <p class="{% if active == 'calendar' %}text-primary dark:text-primary text-sm font-semibold leading-normal{% else %}text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal{% endif %}">Calendrier</p>
      </a>

      <div class="flex flex-col gap-0">
        <a class="flex items-center gap-3 px-3 py-2.5 rounded-xl {% if active == 'chat' %}bg-primary/15 dark:bg-primary/20 border border-primary/30 dark:border-primary/40{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:chat' %}">
          <span class="material-symbols-outlined {% if active == 'chat' %}text-primary dark:text-primary{% else %}text-[#111318] dark:text-slate-300{% endif %}">mail</span>
          <p class="{% if active == 'chat' %}text-primary dark:text-primary text-sm font-semibold leading-normal{% else %}text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal{% endif %}">Emails</p>
        </a>

        {% if active == 'chat' %}
        <!-- Sous-menu Emails (pr√©sent uniquement sur la page Messagerie) -->
        <div class="pl-8 flex flex-col gap-1 border-l-2 border-primary/30 ml-3 my-2">
          <a class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm {% if box_type == 'inbox' %}bg-primary/15 dark:bg-primary/20 text-primary font-semibold border border-primary/30{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 text-[#111318] dark:text-slate-300 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:chat' %}?box=inbox">
            <span class="material-symbols-outlined text-sm">inbox</span>
            <span>Bo√Æte de r√©ception</span>
            {% if unread_count and unread_count > 0 %}<span class="ml-auto text-xs bg-red-500 text-white rounded-full px-2">{{ unread_count }}</span>{% endif %}
          </a>
          <a class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm {% if box_type == 'sent' %}bg-primary/15 dark:bg-primary/20 text-primary font-semibold border border-primary/30{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 text-[#111318] dark:text-slate-300 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:chat' %}?box=sent">
            <span class="material-symbols-outlined text-sm">send</span>
            <span>Envoy√©s</span>
          </a>
          <a class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm {% if box_type == 'drafts' %}bg-primary/15 dark:bg-primary/20 text-primary font-semibold border border-primary/30{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 text-[#111318] dark:text-slate-300 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:chat' %}?box=drafts">
            <span class="material-symbols-outlined text-sm">draft</span>
            <span>Brouillons</span>
          </a>
          <a class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm {% if box_type == 'trash' %}bg-primary/15 dark:bg-primary/20 text-primary font-semibold border border-primary/30{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 text-[#111318] dark:text-slate-300 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:chat' %}?box=trash">
            <span class="material-symbols-outlined text-sm">delete</span>
            <span>Corbeille</span>
          </a>
        </div>
        {% endif %}
      </div>

      <a class="flex items-center gap-3 px-3 py-2.5 rounded-xl {% if active == 'forum' %}bg-primary/15 dark:bg-primary/20 border border-primary/30 dark:border-primary/40{% else %}hover:bg-slate-100 dark:hover:bg-slate-700 border border-slate-200 dark:border-slate-700{% endif %} transition-all duration-200" href="{% url 'dashboard:forum' %}">
        <span class="material-symbols-outlined {% if active == 'forum' %}text-primary dark:text-primary{% else %}text-[#111318] dark:text-slate-300{% endif %}">forum</span>
        <p class="{% if active == 'forum' %}text-primary dark:text-primary text-sm font-semibold leading-normal{% else %}text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal{% endif %}">Forum</p>
      </a>

      <button onclick="openCampusMap()" class="flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 border border-slate-200 dark:border-slate-700 text-left w-full transition-all duration-200">
        <span class="material-symbols-outlined text-[#111318] dark:text-slate-300">map</span>
        <p class="text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal">Plan du Campus</p>
      </button>
    </nav>
  </div>

  <div class="flex flex-col gap-3 border-t border-slate-200 dark:border-slate-700 pt-4">
    <a class="flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 border border-slate-200 dark:border-slate-700 transition-all duration-200" href="{% url 'dashboard:profile' %}">
      <span class="material-symbols-outlined text-[#111318] dark:text-slate-300">account_circle</span>
      <p class="text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal">Mon Profil</p>
    </a>
    <a class="flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-red-50 dark:hover:bg-red-900/20 border border-red-200 dark:border-red-800 transition-all duration-200" href="{% url 'dashboard:logout' %}">
      <span class="material-symbols-outlined text-red-500">logout</span>
      <p class="text-red-500 text-sm font-medium leading-normal">D√©connexion</p>
    </a>
  </div>

</aside>

<!-- MODALE PLAN DU CAMPUS (partag√©e) -->
<div id="campusMapModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-slate-900 rounded-xl max-w-7xl w-full max-h-[90vh] overflow-hidden flex flex-col">
    <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
      <div class="flex items-center gap-3">
        <span class="material-symbols-outlined text-primary">map</span>
        <h2 class="text-xl font-bold text-[#111318] dark:text-white">Plan du Campus UBO - Brest</h2>
      </div>
      <button onclick="closeCampusMap()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg">
        <span class="material-symbols-outlined text-[#616f89] dark:text-slate-400">close</span>
      </button>
    </div>
    <div class="flex-1 overflow-auto p-6 bg-slate-50 dark:bg-slate-800/50">
      <img src="https://www.univ-brest.fr/faculte-medecine/sites/faculte-medecine.www.univ-brest.fr/files/2022-05/PLAN-CAMPUS-BREST-horizontal_amphis500-600.png" alt="Plan du Campus UBO Brest" class="w-full h-auto rounded-lg shadow-lg">
    </div>
    <div class="p-4 border-t border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/30">
      <p class="text-sm text-[#616f89] dark:text-slate-400 text-center">üìç Campus de Brest - Universit√© de Bretagne Occidentale</p>
    </div>
  </div>
</div>

<script>
  function openCampusMap() {
    const modal = document.getElementById('campusMapModal');
    if (modal) {
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
  }
  function closeCampusMap() {
    const modal = document.getElementById('campusMapModal');
    if (modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  }
  document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeCampusMap(); });
  document.addEventListener('click', function(e) { const modal = document.getElementById('campusMapModal'); if (modal && e.target === modal) closeCampusMap(); });
</script>
