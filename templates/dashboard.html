{% load static %}
<!DOCTYPE html>
<html class="light" lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Tableau de Bord - Hub Étudiant UBO</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script id="tailwind-config">tailwind.config = {darkMode: "class", theme: {extend: {colors: {primary: "#F4C753", "background-light": "#f8f7f6", "background-dark": "#221d10",
        /* Couleurs supplémentaires pour les événements */
        course_teal: "#2dd4bf", /* Teinte Turquoise/Cyan */
        course_indigo: "#4f46e5", /* Teinte Indigo */
        course_red: "#ef4444", /* Teinte Rouge */
        }, fontFamily: {display: "Lexend"}, borderRadius: {DEFAULT: "0.25rem", lg: "0.5rem", xl: "0.75rem", full: "9999px"}}}};</script>
<style>
 .material-symbols-outlined {
font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
font-size: 24px;
}
/* Définition des styles de couleur basés sur le code injecté par la vue Python */
.event-color-primary { background-color: rgba(244, 199, 83, 0.2); border-left-color: #F4C753; }
.event-color-teal { background-color: rgba(45, 212, 191, 0.1); border-left-color: #2dd4bf; }
.event-color-indigo { background-color: rgba(79, 70, 229, 0.1); border-left-color: #4f46e5; }
.event-color-red { background-color: rgba(239, 68, 68, 0.1); border-left-color: #ef4444; }

.text-color-primary { color: #F4C753; }
.text-color-teal { color: #2dd4bf; }
.text-color-indigo { color: #4f46e5; }
.text-color-red { color: #ef4444; }

/* Correction des couleurs de texte pour le dark mode */
.dark .event-color-primary { background-color: rgba(244, 199, 83, 0.2); }
.dark .text-color-primary { color: #F4C753; }
</style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
<div class="flex h-full min-h-screen">
<aside class="flex h-screen min-h-[700px] w-64 flex-col justify-between bg-white dark:bg-slate-900 p-4 border-r border-slate-200 dark:border-slate-800 sticky top-0">
<div class="flex flex-col gap-6">
<div class="flex items-center gap-3 px-3">
    <img src="{% static 'images/images.png' %}" alt="Logo UBO" class="size-10"/> 
    <div class="flex flex-col">
        <h1 class="text-[#111318] dark:text-white text-base font-bold leading-normal">UBO</h1>
        <p class="text-[#616f89] dark:text-slate-400 text-sm font-normal leading-normal">Hub Étudiant</p>
    </div>
</div>
<nav class="flex flex-col gap-2">
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 dark:bg-primary/20" 
       href="{% url 'dashboard:dashboard' %}"> 
        <span class="material-symbols-outlined text-primary dark:text-primary">home</span>
        <p class="text-primary dark:text-primary text-sm font-medium leading-normal">Accueil</p>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800" 
       href="{% url 'dashboard:calendar' %}">
        <span class="material-symbols-outlined text-[#111318] dark:text-slate-300">calendar_month</span>
        <p class="text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal">Calendrier</p>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800" 
    href="{% url 'dashboard:chat' %}">
        <span class="material-symbols-outlined text-[#111318] dark:text-slate-300">mail</span>
        <p class="text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal">Emails</p>
    </a>
    <a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800" href="{% url 'dashboard:forum' %}">
        <span class="material-symbols-outlined text-[#111318] dark:text-slate-300">forum</span>
        <p class="text-[#111318] dark:text-slate-300 text-sm font-medium leading-normal">Forum</p>
    </a>
</nav>
</div>
<div class="flex flex-col gap-1">
</div>
</aside>
<main class="flex-1 p-8">
<div class="flex flex-col gap-8">
<header class="flex items-center justify-between gap-4">
<div class="flex flex-col gap-1">
    <h1 class="text-[#111318] dark:text-white text-3xl font-bold leading-tight tracking-tight">Tableau de Bord</h1>
    <p class="text-[#616f89] dark:text-slate-400 text-base font-normal leading-normal">Bonjour, {{ user.full_name|default:"Étudiant UBO" }}. Voici vos informations clés.</p>
</div>
<div class="flex items-center gap-4">
    <button class="p-2.5 text-[#616f89] dark:text-slate-400 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900">
        <span class="material-symbols-outlined">notifications</span>
    </button>
    
    <a class="p-2.5 text-[#111318] dark:text-slate-300 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900" 
       href="{% url 'dashboard:profile' %}">
        <span class="material-symbols-outlined">account_circle</span>
    </a>

    <a class="p-2.5 text-red-500 rounded-lg hover:bg-red-50 dark:hover:bg-slate-800 border border-red-200 dark:border-red-700 bg-white dark:bg-slate-900" 
       href="{% url 'dashboard:logout' %}">
        <span class="material-symbols-outlined">logout</span>
    </a>
</div>
</header>
<div class="grid grid-cols-2 gap-8">
    
    <div class="flex flex-col bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 col-span-1">
        
        <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
            <h2 class="text-lg font-semibold text-[#111318] dark:text-white">Emploi du temps : Aujourd'hui</h2>
            <a class="px-4 py-2 text-sm font-medium border rounded-md border-slate-200 dark:border-slate-700 text-[#111318] dark:text-white hover:bg-slate-100 dark:hover:bg-slate-800"
               href="{% url 'dashboard:calendar' %}">Voir la semaine</a>
        </div>

        <div class="grid grid-cols-[50px_1fr] divide-x divide-slate-200 dark:divide-slate-800">
            
            <div class="flex flex-col">
                <div class="p-4 border-b border-slate-200 dark:border-slate-800 h-[72px] bg-slate-50 dark:bg-slate-800"></div>
                <div class="flex flex-col relative h-[1000px] divide-y divide-dashed divide-slate-300 dark:divide-slate-700">
                    {% for hour in hours %} 
                    <div class="relative h-[100px]">
                        <span class="absolute -top-3 right-1 text-xs text-slate-500 dark:text-slate-400 font-medium">{{ hour }}:00</span>
                    </div>
                    {% endfor %}
                    <span class="absolute -bottom-3 right-1 text-xs text-slate-500 dark:text-slate-400 font-medium">18:00</span>
                </div>
            </div>

            <div class="flex flex-col">
                <div class="p-4 text-center border-b border-slate-200 dark:border-slate-800">
                    <p class="text-sm font-semibold text-[#111318] dark:text-white">{{ today_data.date|date:"l" }}</p>
                    <p class="text-xs text-[#616f89] dark:text-slate-400">{{ today_data.date|date:"d M Y" }}</p>
                </div>
                <div class="p-4 h-[1000px] relative">
                    
                    {% for event in today_data.events %}
                    <div class="absolute left-4 right-4 p-3 rounded-lg border-l-4 border-l-[4px] 
                                event-color-{{ event.color_code }}"
                        style="top: {{ event.total_start_offset }}px; height: {{ event.height }}px;">
                        
                        <p class="text-sm font-bold text-color-{{ event.color_code }} whitespace-nowrap overflow-hidden text-ellipsis">
                            {{ event.course.name }}
                        </p>
                        <p class="text-xs text-color-{{ event.color_code }}/80">
                            {{ event.local_start_time|date:"H:i" }} - {{ event.local_end_time|date:"H:i" }} / {{ event.location }}
                        </p>
                    </div>
                    {% empty %}
                    <div class="absolute inset-0 flex items-center justify-center text-slate-500 dark:text-slate-400">
                        <p>Aucun cours programmé aujourd'hui.</p>
                    </div>
                    {% endfor %}
                    
                </div>
            </div>
            
        </div>
        
    </div>
    
    <div class="flex flex-col gap-8 col-span-1">
        
        <div class="flex flex-col bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800">
            <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
                <h2 class="text-lg font-semibold text-[#111318] dark:text-white">Emails non lus ({% if unread_emails %}{{ unread_emails|length }}{% else %}0{% endif %})</h2>
                <a class="text-sm text-primary hover:text-primary/80" href="{% url 'dashboard:chat' %}">Voir tout</a>
            </div>
            <div class="p-4 flex flex-col divide-y divide-slate-200 dark:divide-slate-800">
                {% for email in unread_emails %}
                <div class="py-3 flex flex-col">
                    <p class="text-sm font-semibold text-[#111318] dark:text-white truncate">{{ email.subject }}</p>
                    <p class="text-xs text-[#616f89] dark:text-slate-400">De: {{ email.sender.full_name }}</p>
                </div>
                {% empty %}
                <div class="py-3 text-sm text-slate-500 dark:text-slate-400">
                    <p>Félicitations ! Vous n'avez aucun email non lu.</p>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="flex flex-col bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800">
            <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
                <h2 class="text-lg font-semibold text-[#111318] dark:text-white">Derniers Posts du Forum</h2>
                <a class="text-sm text-primary hover:text-primary/80" href="{% url 'dashboard:forum' %}">Voir le Forum</a>
            </div>
            <div class="p-4 flex flex-col divide-y divide-slate-200 dark:divide-slate-800">
                {% for post in recent_posts %}
                <div class="py-3 flex flex-col">
                    <span class="text-xs font-medium text-primary">{{ post.channel.name }}</span>
                    <p class="text-sm text-[#111318] dark:text-white line-clamp-2">{{ post.content }}</p>
                    <p class="text-xs text-[#616f89] dark:text-slate-400">Par {{ post.author.full_name }} ({{ post.posted_at|date:"H:i" }})</p>
                </div>
                {% empty %}
                <div class="py-3 text-sm text-slate-500 dark:text-slate-400">
                    <p>Aucun post récent dans les canaux affichés.</p>
                </div>
                {% endfor %}
            </div>
        </div>
        
    </div>

</div>
</div>
</main>
</div>
</div>
</body>
</html>